$(document).ready(function(){function a(a){if(t){e.removeAll();var l={};s.find(".b-sale-geography__city"+(a?"":".collapse.in")+" .shop-data").each(function(){var a=$(this).attr("data-yandex-x"),s=$(this).attr("data-yandex-y");t.setCenter([a,s],14),Obj=$(this).attr("data-index"),l[Obj]=new ymaps.Placemark([a,s],{name:$(this).attr("data-name"),address:$(this).attr("data-address"),worktime:$(this).attr("data-worktime"),phone:$(this).attr("data-phone"),iconContent:'<div class="b-sale-geography__map__marker">'+$(this).attr("data-index")+"</div>"},{balloonContentLayout:o,balloonOffset:[5,0],balloonCloseButton:!0,balloonMinWidth:450,balloonMaxWidth:450,balloonMinHeught:150,balloonMaxHeught:200,iconImageHref:"/bitrix/templates/master_default/components/ao/sale.geography/akrustal/images/point.png",iconImageSize:[58,80],iconImageOffset:[-24,-80],iconLayout:"default#imageWithContent",iconactive:"/bitrix/templates/master_default/components/ao/sale.geography/akrustal/images/point.png"}),e.add(l[Obj])});var i="",r=$(".b-sale-geography__map__title");r.html(),a?(r.html("<h4>Показаны все точки продаж</h4>"),t.setZoom(3)):0!==Object.keys(l).length&&(s.find(".b-sale-geography__city.collapse.in").each(function(){var a=$(this).attr("data-city-title");i+=a+", "}),r.html("<h4>Показаны точки продаж в городах: "+i.substr(0,i.length-2)+"</h4>")),0!==Object.keys(l).length&&(n.show(),t.geoObjects.add(e))}}var t,e,o,s=$(".js-sale-geography"),n=$("#sale-geography-map");ymaps.ready(function(){n.hide(),t=new ymaps.Map("sale-geography-map",{center:n.data("center"),zoom:3});var a=ymaps.templateLayoutFactory.createClass('<div class="b-sale-geography__map__claster">$[properties.geoObjects.length]</div>');e=new ymaps.Clusterer({clusterIcons:[{href:"/bitrix/templates/master_default/components/ao/sale.geography/akrustal/images/cluster.png",size:[58,80],offset:[-24,-80]}],clusterNumbers:[1],zoomMargin:[30],clusterIconContentLayout:a}),o=ymaps.templateLayoutFactory.createClass('<address class="b-sale-geography__map__balloon"><p><strong>$[properties.name]</strong><br /></p><ul class="balloon-info"><li><strong>Адрес:&nbsp;</strong>$[properties.address]</li><li><strong>Часы работы:&nbsp;</strong>$[properties.worktime]</li><li><strong>Телефон:&nbsp;</strong>$[properties.phone]</li></ul></address>')}),window.location.hash&&s.find('.collapsed[href="#collapse_'+window.location.hash.split("#")[1]+'"]').click();var l=$("#sale_geography_accordion");l.on("shown.bs.collapse",function(){var t=s.find(".collapse.in").closest(".panel");window.location.hash=t.data("code"),a()}),l.on("hidden.bs.collapse",function(){var t=s.find(".collapse.in").closest(".panel");window.location.hash=t.data("code"),a()}),s.find("[data-filter]").on("click",function(a){a.preventDefault();var t=$(this).data("filter");t?(s.find(".panel").show().not('[data-country="'+t+'"]').hide(),s.find(".panel:visible:eq(0) a.collapsed").click()):s.find(".panel").show(),$(this).removeClass("btn-default").addClass("btn-primary").siblings(".btn-primary").removeClass("btn-primary").addClass("btn-default")}),$(".b-sale-geography__map__link").on("click",function(a){a.preventDefault();var e=$(this).data("lat"),o=$(this).data("lot");$("html, body").animate({scrollTop:n.offset().top-60},500),t.panTo([e,o],{}).then(function(a){t.setZoom(14,{duration:300})})}),$(".b-sale-geography__map__showall__link").on("click",function(t){t.preventDefault();a(!0)})});